---
title: "Examining the Socioeconomic Dimension of Power Plant Impacts in North Carolina"
author: "Gaby Czarniak, Mara Michel, Sam Sedar"
date: "12-11-2023"
output: 
  html_document:
    toc: true
  
---
# Research Rationale
The impetus behind this research lies in the imperative to address the intricate interplay between socioeconomic factors and power plants. As the global energy landscape undergoes a transformative shift toward sustainability, it becomes paramount to understand how these changes might impact communities, particularly those situated in lower-income communities. The socio-spatial lens through which this study is conducted aims to unearth patterns of power plant distribution across North Carolina. With 100 counties and a total of 843 power plants consisting of 1190 generators (US EPA, 2021), the state's unique landscape offers a rich context for investigation. The overarching question is whether certain communities bear a disproportionate burden of environmentally impactful energy sources, framing the discourse within the realms of environmental justice and equity.

As a key aspect of this exploration, the research considers the connection between power plant location and emissions and various socioeconomic indicators, including but not limited to unemployment rates. This exploration is motivated by the awareness that power plants have often served as major employers in low-income areas (Union of Concerned Scientists, 2021). This research extends its focus beyond energy sources to examine the broader impacts of power plants on health and social vulnerability, and scrutinizes disparities in pollution exposure and associated health risks at a high level, using publicly available data. Through an exploration that encompasses various socioeconomic indicators, this research contributes to a more nuanced understanding of the multifaceted impacts of power plants.

The following research questions are addressed:  
1. How does income impact power plant characteristics at the county level?  
2.Do power plant retirements have a significant impact on unemployment?  
3.Does publicly available data show a relationship between power generation and social vulnerability, health vulnerability, or environmental burden?  


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE,message=FALSE)
library(tidyverse)
library(lubridate)
library(here); here()
library(rvest)
library(cowplot)
library(agricolae)
library(dplyr)
library(tidyverse)
library(lubridate)
library(trend)
library(zoo) 
library(Kendall)
library(tseries)
library(sf)
library(leaflet)
library(tseries)
library(knitr)
library(mapview); mapviewOptions(fgb = FALSE)
getwd()
```
# Dataset Information
Data used in this analysis comes from a variety of sources. A brief overview of each source is outlined below and full citations can be found at the end of this report. More information on the metadata for each source can be found in the 'Metadata' folder.


### Emissions & Generation Resource Integrated Database (eGRID)
The study utilizes the 2020 and 2021 eGRID provided by the U.S. Environmental Protection Agency to acquire essential power plant characteristics. This annually updated database offers comprehensive details on emissions, emission rates, generation, heat input, resource mix, location, and various other indicators. For the specific analyses undertaken in this research, key data elements employed included the plant Federal Information Processing Standards (FIPS) code, generation, nameplate capacity, and emissions by plant.
To process this dataset, the plant and generator sheets undergo individual modifications before being integrated. Notably, columns relevant to the analyses were selected, an additional column was introduced to consolidate state and county FIPS codes into a unified county FIPS code, and the overall dataset was filtered to North Carolina, exclusively. A parallel procedure is executed for the generator sheet before merging the two datasets using the unique ORISPL code.

It is important to highlight that although the most recent eGRID database available was from 2021, this version lacked historical generator retirement data. Consequently, the 2020 eGRID database is incorporated to facilitate the analysis of unemployment trends related to generator retirements.

### Economic Research Service Datasets: Median Household Income
To establish a nexus between power plants and socioeconomic factors, household income data is derived from data compiled by the Economic Research Service of the United States Department of Agriculture. This data includes metrics such as household income and poverty rates at the county level, with identification facilitated by the Federal Information Processing Standards (FIPS) Code. The preparation of this dataset involves the extraction of pertinent columns, specifically median household income, followed by integration with the initial eGRID dataframe. The unifying factor for this integration is the FIPS Code, which served as the common column linking the two datasets.

### Economic Research Service Datasets: Unemployment
As an additional facet of investigation, the analysis incorporates unemployment data obtained from the Economic Research Service of the United States Department of Agriculture. The dataset, spanning the years 2000 through 2021, comprises comprehensive information on the total labor force, the number of employed individuals, the number of unemployed individuals, and the unemployment rate. The data wrangling process for this dataset unfolds in two distinct stages. Initially, the columns of interest, specifically those pertaining to the unemployment rate, are  selected. Following this, the identified columns undergo appropriate conversions to their intended data types before being merged with the existing dataset, utilizing the county FIPS code as the linking identifier.

The subsequent phase of data wrangling introduces additional steps specifically tailored for conducting regression analyses between generator retirements and unemployment rates. To facilitate this analysis, the code executes a transposition of the data. This transformation presents North Carolina county unemployment rates by year in a more streamlined format, allocating a dedicated column for each year. 

### Social Vulnerability Index 
2020 data from the US CDC on key vulnerability criteria including socioeconomic status, household characteristics, racial & ethnic minority status, and house type & transportation.

### Environmental Justice Index 
2022 report on environmental burden, social vulnerability, and health vulnerability indicators. The Environmental Protection Agency (EPA) Environmental Justice Index (EJI) team selected the indicators based on a literature review conducted between December 2020 and December 2021.

### Spatial Data
2020 data from Centers for Disease Control and Prevention/ Agency for Toxic Substances and Disease Registry/ Geospatial Research, Analysis, and Services Program is utilized for visualizations of data at the county level.


Table: Table 1: Dataset Information

Dataset |  Attribute    | Description
----------- |---------------| -------------
eGRID  |  Key Variables | Plant locations, production, capacity, retirements, and emissions
eGRID  |Data Hierarchy | Generators are associated to plants, plants are associated to counties and FIPS codes
eGRID  |Data Range | 2020 (dataset used only to reference historical retirement data) and 2021 (all other data)
eGRID  |Data Source |The United States Environmental Protection Agency
Income  |  Key Variables | Median Household Income, FIPS codes
Income |Data Hierarchy | Income data is associated with FIPS county code
Income |Data Range | 2021
Income |Data Source | The Economic Research Service of the United States Department of Agriculture
Unemployment  |  Key Variables | Unemployment rate, FIPS code
Unemployment    |Data Hierarchy | Unemployment rates are associated with FIPS county code
Unemployment    |Data Range | 2000 to 2021
Unemployment  |Data Source | The Economic Research Service of the United States Department of Agriculture
Social Vulnerability Index  |  Key Variables | Socioeconomic status, household characteristics, racial & ethnic minority status, and house type & transportation
Social Vulnerability Index  |Data Hierarchy | Indicator data is available at the tract level
Social Vulnerability Index  |Data Range | 2020
Social Vulnerability Index  |Data Source | The United States Centers for Disease Control and Prevention/Agency for Toxic Substances and Disease Registry Social Vulnerability Index (CDC/ATSDR SVI)
Environmental Justice Index  |  Key Variables | Environmental burden, social vulnerability, and health vulnerability
Environmental Justice Index  |Data Hierarchy | Indicator data is available at the tract level
Environmental Justice Index  |Data Range | 2020 to 2021
Environmental Justice Index  |Data Source | The United States Agency for Toxic Substances and Disease


```{r, Data_Load, echo=FALSE, warning=FALSE, error= FALSE}

#Loading Data into Raw Data folder

plant <- read.csv(here('Data/Raw/PLNT21.csv'),
                  stringsAsFactors = FALSE, skip = 1, 
                  colClasses = c('FIPSST' = 'character', 
                                 'FIPSCNTY' = 'character',
                                 'ORISPL' = 'character'))

gen <- read.csv(here('Data/Raw/GEN21.csv'), 
                stringsAsFactors = FALSE, skip = 1, 
                  colClasses = c('ORISPL' = 'character'))

gen20 <- read.csv(here('Data/Raw/GEN20.csv'),                 
                  stringsAsFactors = FALSE, skip = 1, 
                  colClasses = c('ORISPL' = 'character'))

income <- read.csv(here('Data/Raw/PovertyEstimates.csv'), 
                  stringsAsFactors = TRUE, skip = 4)

unemployment <- read.csv(here('Data/Raw/Unemployment.csv'), 
                  stringsAsFactors = TRUE, skip = 4)

SVI_county_raw <-read.csv(here('Data/Raw/SVI_NorthCarolina_county.csv'),
                  stringsAsFactors = TRUE)

EJI_countytract <-read.csv(here('Data/Raw/EBM_NorthCarolina.csv'),
                  stringsAsFactors = TRUE)

SVI_2018_tract <-read.csv(here('Data/Raw/SVI2018_NorthCarolina.csv'),
                  stringsAsFactors = TRUE)
```

# Data Wrangling
The initial step in our research, once loaded, was data wrangling on the eGRID, unemployment, and income datasets. Data wrangling, or the process of transforming raw data, was a crucial step in this research, particularly due to the diverse nature of the datasets. For the eGRID dataset, the code selects specific columns related to power plant information in North Carolina, converts certain columns to numeric format, and then combines the generator and plant data based on a common identifier. Duplicate columns are removed, resulting in the plant_gen_data dataframe. The code then proceeds to handle the unemployment dataset, selecting relevant columns covering the years 2002-2022 and merging it with the plant_gen_data dataframe using the FIPS code as a key. Similarly, the income dataset is processed by selecting specific columns, and the final step involves merging this income data with the previously created dataframe. The resulting dataset, named processed_data, contains information on power plants, unemployment rates, and income data, and the column names are displayed at the end of the code. The social vulnerability index and environmental justice datasets are wrangled within the context of Question 3.


```{r, echo=FALSE, warning=FALSE, error=FALSE}
######  DATA WRANGLING - BASELINE  ######

#EGRID DATA

#Selecting columns of interest from plant data
plant_select <- plant %>%
  select(PSTATABB, ORISPL, FIPSST, FIPSCNTY, PLFUELCT, NAMEPCAP,
         PLNGENAN,PLSO2RTA, PLCO2RTA, PLCH4RTA, PLN2ORTA, PLCO2AN, PLN2OAN,PLNOXAN,
         PLSO2AN,PLCH4AN, CNTYNAME, LAT,
         LON, COALFLAG) %>%
  filter(PSTATABB == "NC") %>%
  unite(FIPS_Code, FIPSST, FIPSCNTY, sep = "")

plant_select$PLNGENAN <- as.numeric(plant_select$PLNGENAN)
plant_select$PLCO2RTA <- as.numeric(plant_select$PLCO2RTA)
plant_select$PLCO2AN <- as.numeric(plant_select$PLCO2AN)
plant_select$NAMEPCAP <- as.numeric(plant_select$NAMEPCAP)


#Combining Generator and Plant df based on ORISPL
plant_gen <- gen %>%
  inner_join(plant_select, by = 'ORISPL', 
             suffix = c("_gen", "_plant"))

plant_gen$CFACT <- as.numeric(plant_gen$CFACT)
plant_gen$GENNTOZ <- as.numeric(plant_gen$GENNTOZ)
plant_gen$NAMEPCAP_gen <- as.numeric(plant_gen$NAMEPCAP_gen)
plant_gen$GENNTAN <- as.numeric(plant_gen$GENNTAN)

#Removing duplicate state abbreviation column
plant_gen_data <- plant_gen[, -which(names(plant_gen) == "PSTATABB_plant")]

#Exporting to CSV:
#write.csv(plant_gen_data,'Data/Processed/PLNT_GEN21.csv', row.names=FALSE)

#UNEMPLOYMENT DATA

#Selecting columns of interest: unemployment rates: 2002-2022

ue <- unemployment %>%
  select(FIPS_Code,	Unemployment_rate_2000,	Unemployment_rate_2001,	Unemployment_rate_2002,	Unemployment_rate_2003,	Unemployment_rate_2004,	Unemployment_rate_2005,	Unemployment_rate_2006,	Unemployment_rate_2007,	Unemployment_rate_2008,	Unemployment_rate_2009,	Unemployment_rate_2010,	Unemployment_rate_2011,	Unemployment_rate_2012,	Unemployment_rate_2013,	Unemployment_rate_2014,	Unemployment_rate_2015,	Unemployment_rate_2016,	Unemployment_rate_2017,	Unemployment_rate_2018,	Unemployment_rate_2019,	Unemployment_rate_2020,	Unemployment_rate_2021,	Unemployment_rate_2022)

#Exporting to CSV:
#write.csv(ue,'Data/Processed/Unemployment2000_2022.csv', row.names=FALSE)

#Merging with eGrid
ue_egrid <- merge(plant_gen_data, ue, by = "FIPS_Code")

#Exporting to CSV:
#write.csv(ue_egrid,'Data/Processed/Unemployment2000_2022_eGrid21.csv', row.names=FALSE)

#INCOME DATA

#Selecting columns of interest: 
inc <- income %>%
  select(FIPS_Code, PCTPOVALL_2021, MEDHHINC_2021)

#Exporting to CSV:
#write.csv(inc,'Data/Processed/Income2021.csv', row.names=FALSE)

#Merging
processed_data <- merge(ue_egrid, inc, by = "FIPS_Code")

#Exporting to CSV:
#write.csv(processed_data,'Data/Processed/Income_Unemployment_eGrid.csv', row.names=FALSE)
```

# Exploratory Analysis
This analysis initiates data exploration and visualization for the processed_data dataframe, focusing on fuel types, income, and electricity generation in North Carolina. Figure 1 generates a pie chart to illustrate the percentage makeup of primary fuel types in North Carolina based on total annual generation. Subsequently, the scatter plot in Figure 2 depicts the relationship between median household income and total plant annual generation, with points colored by fuel type. The exploratory analysis further drills down to scatter plots excluding nuclear data and for a selected set of fuel types (COAL, SOLAR, OIL, WIND, GAS). Additionally, stacked bar plots in Figures 5 and 6  visualize the total annual generation by fuel type and county, and for better clarity, separate plots are created for the top 10 and bottom 10 counties based on median household income. These visualizations help explore and understand the relationships between fuel types, income levels, and electricity generation in different counties of North Carolina.

##### Figure 1: Pie chart illustrating the percentage distribution of primary fuel types in North Carolina based on total annual generation.

```{r, Exploration, echo=FALSE, warning=FALSE, error=FALSE}

########### DATA EXPLORATION - FUEL TYPES ###########

#NC Breakdown of Fuel by Category
fuel_summarized <- processed_data %>%
  group_by(PLFUELCT) %>%
  summarise(total_generation = sum(PLNGENAN, na.rm = TRUE))

#In percentages
fuel_summarized$percentage <- fuel_summarized$total_generation / sum(fuel_summarized$total_generation) * 100

#Pie chart with percent makeup of fuel in  NC
pie_chart_percentage <- ggplot(fuel_summarized, aes(x = "", fill = PLFUELCT, y = percentage)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar(theta = "y") +
  labs(
    title = "North Carolina Primary Fuel (% of Total Annual Generation)",
    fill = "Primary Fuel Type",
    y = "Percentage of Total Generation (%)",
    x = NULL)
print(pie_chart_percentage)
```

##### Figure 2: Scatter plot illustrating the correlation between median household income and total annual generation, color-coded by fuel type. Owing to the unique characteristics of nuclear power plants, operating at significantly higher capacity factors than other sources, the plot lacks a discernible relationship, prompting necessary adjustments. 

```{r, income_type, echo=FALSE, warning=FALSE, error=FALSE}
#Relationship between income and fuel type
processed_data$MEDHHINC_2021 <- as.numeric(processed_data$MEDHHINC_2021)

#Scatter visualization
scatter_income_generation <- ggplot(processed_data, aes(x = MEDHHINC_2021, y = PLNGENAN, color = PLFUELCT)) +
  geom_point() +
  labs(title = "Income and Annual Generation by Fuel Type",
       x = "Median Household Income ($)",
       y = "Total Plant Annual Generation (MWh)",
       color = "Fuel Type",
caption = "")
print(scatter_income_generation)
```

##### Figure 3: Exploring energy patterns, this scatter plot analyzes the connection between median household income and total annual generation, excluding nuclear energy. The updated chart reveals a potential trend, especially around the $70,000 median income mark, where data points for generation are sparse.

```{r, ex_nuclear, echo=FALSE, warning=FALSE, error=FALSE}
#Scatter ex-nuclear
scatter_income_generation_ex_nuc <- ggplot(subset(processed_data, PLFUELCT != "NUCLEAR"), 
                                     aes(x = MEDHHINC_2021, y = PLNGENAN, color = PLFUELCT)) +
  geom_point() +
  labs(title = "Relationship Between Annual Generation, Fuel Type, and Income",
       x = "Median Household Income ($)",
       y = "Total Plant Annual Generation (MWh)",
       color = "Fuel Type")
print(scatter_income_generation_ex_nuc)

```

##### Figure 4: To narrow our exploration further, we selected key energy sources: coal, gas, oil, wind, and solar.

```{r, select, echo=FALSE, warning=FALSE, error=FALSE}

selected_fuel_data <- subset(processed_data, PLFUELCT %in% c("COAL", "SOLAR", "OIL", "WIND", "GAS"))

# Scatter plot for selected fuel types
scatter_income_generation_selected <- ggplot(selected_fuel_data, 
                                              aes(x = MEDHHINC_2021, y = PLNGENAN, color = PLFUELCT)) +
  geom_point() +
  labs(title = "Relationship Between Annual Generation, Fuel Type, and Income",
       x = "Median Household Income ($)",
       y = "Total Plant Annual Generation (MWh)",
       color = "Fuel Type")
print(scatter_income_generation_selected)

```

##### Figure 5: Stacked bar plot illustrating the total annual generation by fuel type in the top 10 counties (by median income) in North Carolina.

```{r, top10, echo=FALSE, warning=FALSE, error=FALSE}
#Top 10 counties based on median household income
top_income_counties <- processed_data %>%
  group_by(CNTYNAME) %>%
  summarize(median_income = median(MEDHHINC_2021, na.rm = TRUE)) %>%
  top_n(10, median_income) %>%
  pull(CNTYNAME)

filtered_data_income <- processed_data %>%
  filter(CNTYNAME %in% top_income_counties)

#Stacked bar plot
stacked_barplot_top_income_counties <- ggplot(filtered_data_income, aes(x = CNTYNAME, y = PLNGENAN, fill = PLFUELCT)) +
  geom_bar(stat = "sum", position = "stack") +
  labs(title = "Total Annual Generation by Fuel Type and County \n (Top 10 by Median Income)",
       x = "County",
       y = "Total Plant Annual Generation (MWh)",
       fill = "Fuel Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(stacked_barplot_top_income_counties)
```

##### Figure 6: To get a balanced view of the total annual generation by fuel type and county, we then show the bottom 10 counties (by median income) in North Carolina. This identified Richmond county as a county of interest.

```{r, bottom10, echo=FALSE, warning=FALSE, error=FALSE}
#Bottom 10 counties based on median household income
bottom_income_counties <- processed_data %>%
  group_by(CNTYNAME) %>%
  summarize(median_income = median(MEDHHINC_2021, na.rm = TRUE)) %>%
  arrange(median_income) %>%
  slice_head(n = 10) %>%
  pull(CNTYNAME)

filtered_data_bottom_income <- processed_data %>%
  filter(CNTYNAME %in% bottom_income_counties)

#Stacked bar plot
stacked_barplot_bottom_income_counties <- ggplot(filtered_data_bottom_income, aes(x = CNTYNAME, y = PLNGENAN, fill = PLFUELCT)) +
  geom_bar(stat = "sum", position = "stack") +
  labs(title = "Total Annual Generation by Fuel Type and County \n (Bottom 10 by Median Income)",
       x = "County",
       y = "Total Plant Annual Generation (MWh)",
       fill = "Fuel Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(stacked_barplot_bottom_income_counties)
```

We then created initial maps to better understand the landscape of North Carolina in terms of socioeconomic status and geographic distribution of power plants. Figure 7 below shows the mapping of power plants across the state and helped us to visualize the concentration of power plants across the state. Figure 8 maps the nameplate capacity of those power plants by county. We noticed that multiple counties, especially Richmond county, stood out as having a high concentration of capacity. Figure 9 demonstrates a heat map of the percentage of each county's population living in poverty as of 2021. Richmond county is once again a clear visual outlier on this map.

##### Figure 7: Locations of active power plants across North Carolina as of 2021. Each black dot represents a power plant.

```{r Initial Maps - county and eGRID location data,echo=FALSE, message=FALSE,warning=FALSE, include=FALSE}
#Load in counties spatial data
counties_sf<- st_read(here('Data/Spatial/cb_2018_us_county_20m.shp')) %>%
  filter(STATEFP==37)

#Convert eGrid tabular data to spatial data
plant_gen_sf <-plant_gen_data %>% st_as_sf(coords = c('LON','LAT'), crs=4269)
```

```{r Initial Maps - Power plant locations}
#Create initial map of power plants
gens_counties_map <-ggplot()+
  geom_sf(data=counties_sf)+
  geom_sf(data=plant_gen_sf,size=0.8)+
  labs(title = "Locations of NC Power Plants")
print(gens_counties_map)
```

##### Figure 8: This map shows the total nameplate capacity in Megawatts of each county in North Carolina. Multiple counties have no power plants and are blank. Richmond County is an interesting outlier which the highest capacity of all the counties.
```{r Initial Maps - Nameplate capacity}

#Compute sum of nameplate capacity by county
nameplate_capacity <-plant_gen_data %>%
  group_by(CNTYNAME)%>%
  summarize(Sum_NAMEPCAP = sum(NAMEPCAP_plant))
#Join the eGrid attributes to the county spatial features
counties_sf_join <-  merge(x = counties_sf,
                           y = plant_gen_data, 
                           by.x = 'NAME', 
                           by.y = 'CNTYNAME' )
#Map total generator capacity by county
gen_cap_map <-ggplot(data=counties_sf_join)+
  geom_sf(aes(fill=NAMEPCAP_plant))+labs(title="Capacity by County",fill="Capacity (MW)")
print(gen_cap_map)
```

##### Figure 9: Percent of total county population living in poverty in 2021, as defined by the USDA Economic Research Service.
```{r Initial Maps - Income by county}
## Heat map of Income Data by County ##
#Create data frame of NC income data
income_NC <-income %>% 
  filter(Stabr=='NC')
#Join the income attributes to the county spatial features
income_NC_sf_join <-  merge(x = counties_sf,
                           y = income_NC, 
                           by.x = 'GEOID', 
                           by.y = 'FIPS_Code')
#Map pct in poverty by county
income_heat_map <-ggplot(data=income_NC_sf_join)+
  geom_sf(aes(fill=PCTPOV017_2021))+labs(title= "% of County in Poverty - 2021", fill="%")
print (income_heat_map)
```

Additionally, we explored power plant emissions geographically as a final stage of our exploratory analysis. Figures 10-14 demonstrate the aggregated power plant emissions per county in 2021 for CO2, NOx, SO2, N20, and CH4 respectively. Unfortunately eGrid did not provide data for Mercury (Hg) in 2021 so that was not analyzed. N20 and CH4 are provided in lbs while CO2, NOx, and SO2 are in short tons. For CO2 emissions, Richmond county stood out. For NOx emissions, Catawba county stood out. For SO2 emissions, Catawba, Haywood, and Person counties stood out.For N20 and CH4 emissions, Catawba and Person counties stood out.

##### Figure 10: Total CO2 Emissions in 2021 across North Carolina Power Plants.
```{r Power Plant Emissions Heat Maps}
#Heat map of CO2 emissions by county
#Compute sum of CO2 Emissions by county
CO2_emissions <-plant_gen_data %>%
  drop_na(PLCO2AN)%>%
  group_by(CNTYNAME)%>%
  summarize(Sum_CO2 = sum(PLCO2AN))
#Join the eGrid attributes to the county spatial features
CO2_counties_sf_join <-  merge(x = counties_sf,
                           y = CO2_emissions, 
                           by.x = 'NAME', 
                           by.y = 'CNTYNAME')
#Map CO2 emissions by county
CO2_map <-ggplot(data=CO2_counties_sf_join)+geom_sf(data=counties_sf)+
  geom_sf(aes(fill=Sum_CO2))+
  labs(title="2021 CO2 Emissions",
       fill="CO2 Emissions (tn)")
print(CO2_map)
```

##### Figure 11: Total NOx Emissions in 2021 across North Carolina Power Plants.

```{r, NOX Emissions}
#Heat map of NOx emissions by county
#Compute sum of NOx Emissions by county
NOx_emissions <-plant_gen_data %>%
  drop_na(PLNOXAN)%>%
  group_by(CNTYNAME)%>%
  summarize(Sum_NOx = sum(PLNOXAN))
#Join the eGrid attributes to the county spatial features
NOx_counties_sf_join <-  merge(x = counties_sf,
                           y = NOx_emissions, 
                           by.x = 'NAME', 
                           by.y = 'CNTYNAME')

#Map NOx emissions by county
NOx_map <-ggplot(data= NOx_counties_sf_join)+
  geom_sf(data=counties_sf)+
  geom_sf(aes(fill=Sum_NOx))+
  labs(title="2021 NOx Emissions",
       fill=" NOx Emissions (tn)")
print(NOx_map)
```

##### Figure 12: Total SO2 Emissions in 2021 across North Carolina Power Plants.

```{r, SO2 Emissions}
#Heat map of SO2 emissions by county
#Compute sum of SO2 Emissions by county
SO2_emissions <-plant_gen_data %>%
  drop_na(PLSO2AN)%>%
  group_by(CNTYNAME)%>%
  summarize(Sum_SO2 = sum(PLSO2AN))
#Join the eGrid attributes to the county spatial features
SO2_counties_sf_join <-  merge(x = counties_sf,
                           y = SO2_emissions, 
                           by.x = 'NAME', 
                           by.y = 'CNTYNAME')
#Map SO2 emissions by county
SO2_map <-ggplot(data=SO2_counties_sf_join)+
  geom_sf(data=counties_sf)+
  geom_sf(aes(fill=Sum_SO2))+
  labs(title="2021 SO2 Emissions",
       fill="SO2 Emissions (tn)")
print(SO2_map)
```

##### Figure 13: Total N20 Emissions in 2021 across North Carolina Power Plants.

```{r, N20 Emissions}
#Heat map of N2O emissions by county
#Compute sum of N2O Emissions by county
N2O_emissions <-plant_gen_data %>%
  drop_na(PLN2OAN)%>%
  group_by(CNTYNAME)%>%
  summarize(Sum_N2O = sum(PLN2OAN))
#Join the eGrid attributes to the county spatial features
N2O_counties_sf_join <- merge(x = counties_sf,
                           y = N2O_emissions, 
                           by.x = 'NAME', 
                           by.y = 'CNTYNAME')
#Map N2O emissions by county
N2O_map <-ggplot(data= N2O_counties_sf_join)+
  geom_sf(data=counties_sf)+
  geom_sf(aes(fill=Sum_N2O))+
  labs(title="2021 N2O Emissions",
       fill=" N2O Emissions (lbs)")
print(N2O_map)
```

##### Figure 14: Total CH4 Emissions in 2021 across North Carolina Power Plants.

```{r, CH4 Emissions}
#Heat map of CH4 emissions by county
#Compute sum of CH4 Emissions by county
CH4_emissions <-plant_gen_data %>%
  drop_na(PLCH4AN)%>%
  group_by(CNTYNAME)%>%
  summarize(Sum_CH4 = sum(PLCH4AN))
#Join the eGrid attributes to the county spatial features
CH4_counties_sf_join <- merge(x = counties_sf,
                           y = CH4_emissions, 
                           by.x = 'NAME', 
                           by.y = 'CNTYNAME')
#Map CH4 emissions by county
CH4_map <-ggplot(data= CH4_counties_sf_join)+
  geom_sf(data=counties_sf)+
  geom_sf(aes(fill=Sum_CH4))+
  labs(title="2021 CH4 Emissions",
       fill="CH4 Emissions (lbs)")
print(CH4_map)
```


# Question 1: How does income impact power plant characteristics at the county level?

Null Hypothesis: The economic status of a community does not bear a statistically significant impact on the features of its power infrastructure.

This analysis begins by examining the impact that income has on various power plant characteristics. This first analysis uses income as the highest-level socioeconomic indicator, as income often dictates an array of follow-on indicators. Several regressions are conducted including the impact of income on the fuel type (differentiating between clean and dirty sources), number of plants, and nameplate capacity. 

Examining only the impact of income on coal plants, the estimated coefficient is approximately -134.6. This suggests that for each one-unit increase in income, the predicted value of coal generation decreases by approximately 134.6 MWh. The coefficient's p-value (0.1049) is greater than 0.05, indicating that it is not statistically significant at the 0.05 significance level. Furthermore, the R^2 suggests that only about 13.24% of the variability in coal generation is explained by income. Figure 15 below visualizes this relationship.

```{r, Income_and_Fuel, echo=FALSE, warning=FALSE, error=FALSE}

########### DATA ANALYSIS - INCOME AND FUEL TYPE ###########

#Coal linear regression
coal_data <- subset(processed_data, PLFUELCT == "COAL")
linear_model_coal <- lm(PLNGENAN ~ MEDHHINC_2021, data = coal_data)
summary_table <- summary(linear_model_coal)$coef

knitr::kable(summary(linear_model_coal)$coef, format = "html", caption = "Linear Regression Results - Coal")

```

##### Figure 15: Relationship of median household income ($) on coal generation (MWh) in 2021 by county.

```{r warning=TRUE}
#Visualize relationship
scatter_coal <- ggplot(coal_data, aes(x = MEDHHINC_2021, y = PLNGENAN)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "County Income and Coal Generation",
       x = "Median Household Income ($)",
       y = "Coal Generation (MWh)")
print(scatter_coal)
```

The linear regression shown in Figure 16 below suggests that there might be a relationship between income and solar generation. The statistically significant p-value (0.04707) indicates that there is evidence to suggest that an increase in median household income is associated with a decrease in the predicted value of solar generation However, it's important to note that the explained variance is quite low (about 0.56%), and so other factors not included in the model likely contribute to the variability in generation for solar.

```{r echo=FALSE, error=FALSE, warning=FALSE, solar}

#Solar linear regression
solar_data <- subset(processed_data, PLFUELCT == "SOLAR")
linear_model_solar <- lm(PLNGENAN ~ MEDHHINC_2021, data = solar_data)

knitr::kable(summary(linear_model_solar)$coef, format = "html", caption = "Linear Regression Results - Solar")
```

##### Figure 16: Relationship of median household income ($) on solar generation (MWh) in 2021 by county.

```{r, solar plot, echo = FALSE}
#Visualize relationship
scatter_solar <- ggplot(solar_data, aes(x = MEDHHINC_2021, y = PLNGENAN)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "County Income and Solar Generation",
       x = "Median Household Income ($)",
       y = "Solar Generation (MWh)")
print(scatter_solar)
```

The next stage of analysis examined if there was a relationship between the quantity of generators and median household income. The linear regression results indicate that median household income does not show a statistically significant association with the number of plants. The coefficient is estimated to be -0.0000786, with a standard error of 0.0000922, a t-value of -0.85, and a p-value of 0.3962. This suggests that, based on the available data, changes in median household income do not appear to be statistically linked to variations in the number of plants. Figure 17 below illustrates this relationship.

```{r, viz_solar, echo=FALSE, warning=FALSE, error=FALSE}

################ DATA ANALYSIS: INCOME AND POWER PLANTS ####################

#Regression on Income and the Number of Power Plants

### Pre-Analysis Wrangling ###
online_plants <- processed_data %>%
  drop_na(GENYRONL) %>%
  select(FIPS_Code, CNTYNAME, SEQGEN, YEAR, PNAME, 
         GENID, GENSTAT, GENYRONL, NAMEPCAP_plant, 
         PLNGENAN, PLCO2AN, COALFLAG, MEDHHINC_2021,	
         Unemployment_rate_2000,	Unemployment_rate_2001,	
         Unemployment_rate_2002,	Unemployment_rate_2003,	
         Unemployment_rate_2004,	Unemployment_rate_2005,	
         Unemployment_rate_2006,	Unemployment_rate_2007,	
         Unemployment_rate_2008,	Unemployment_rate_2009,	
         Unemployment_rate_2010,	Unemployment_rate_2011,	
         Unemployment_rate_2012,	Unemployment_rate_2013,	
         Unemployment_rate_2014,	Unemployment_rate_2015,	
         Unemployment_rate_2016,	Unemployment_rate_2017,	
         Unemployment_rate_2018,	Unemployment_rate_2019,	
         Unemployment_rate_2020,	Unemployment_rate_2021,	
         Unemployment_rate_2022)

# Creating separate df with plants by FIPS_Code
county_plants_table <- table(online_plants$FIPS_Code)
view(county_plants_table)
county_plants_df <- as.data.frame(county_plants_table)

#Renaming columnnames
colnames(county_plants_df)[colnames(county_plants_df) == "Var1"] <- "FIPS_Code"
colnames(county_plants_df)[colnames(county_plants_df) == "Freq"] <- "Num_Plants"
#add in income data
merged_data <- merge(county_plants_df, income[, c("FIPS_Code", "MEDHHINC_2021")], by = "FIPS_Code", all.x = TRUE)
# Merge back to original
county_plants_df <- merged_data

### Regression Analysis ###

#Run simple regression
inc_plants_model <- lm(Num_Plants ~ MEDHHINC_2021, data = county_plants_df)

knitr::kable(summary(inc_plants_model)$coef, format = "html", caption = "Linear Regression Results - Number of Plants")
```

##### Figure 17: Relationship of Median Household Income and Number of Power Plants in NC in 2021 by county.

```{r,power plants number}
#Plot relationship
ggplot(county_plants_df, aes(x = MEDHHINC_2021, y = Num_Plants)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "County Income and Number of Power Plants",
       x = "Median Household Income($)",
       y = "Number of Power Plants")
```



As different power plants are different sizes, especially across different fuel types, we analyzed if the average nameplate capacity of plants in a county was related to median household income.The linear regression on this relationship yields a coefficient of 0.0019239, accompanied by a standard error of 0.0023465. This implies that, theoretically, an increase in median household income is associated with a slight corresponding increase in Nameplate Capacity. However, the non-significant p-value of 0.4145 means we do not have sufficient evidence to reject the null hypothesis and the observed association between median household income and Nameplate Capacity may be coincidental. Figure 18 below demonstrates this relationship.

```{r, npcap, echo=FALSE, warning=FALSE, error=FALSE}
#Regression on Income and Nameplate Capacity

## Pre-Analysis Wrangling ##

#Calculate average nameplate capacity by county
average_capacity <- aggregate(NAMEPCAP_plant ~ FIPS_Code, data = online_plants, FUN = mean)
merged_data_capacity <- merge(average_capacity, income, by = "FIPS_Code")

## Regression Analysis ##

#Run simple regression
capacity_income_model <- lm(NAMEPCAP_plant ~ MEDHHINC_2021, data = merged_data_capacity)

knitr::kable(summary(capacity_income_model)$coef, format = "html", caption = "Linear Regression Results - Nameplate Capacity")
```

##### Figure 18: Relationship of Median Household Income on Average Nameplate Capacity (MW) by county in 2021.

```{r,nameplate capacity}

#Plot relationship
ggplot(merged_data_capacity, aes(x = MEDHHINC_2021, y = NAMEPCAP_plant)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "County Income and Nameplate",
       x = "Median Household Income($)",
       y = "Average Nameplate Capacity (MW)")

```

Finally, we briefly explored if we could find a statistical relationship between power plants and the social vulnerability index (SVI) instead of income. A linear regression of SVI themes on total annual generation by county was conducted. The coefficient is 3643958 and is positive, suggesting that an increase in the SVI leads to an increase in generation. However, the multiple R-squared value is very small (0.005408), signaling that this model does not fit the data well; with an R-squared so low, RPL Themes could only explain .5% of total generation by county across North Carolina in 2021. Ultimately, the p-value is not statistically significant (0.5278 > .05). The null hypothesis that there is no relationship between generation by county and RPL Themes in North Carolina in 2021 therefore cannot be rejected. The relationship is plotted in Figure 19.

```{r Generation and SVI Relationship Analysis LM}
#Wrangle SVI DATA

#Selecting columns of interest:
SVI_county<-SVI_county_raw %>% select(ST_ABBR, STCNTY,COUNTY,FIPS, LOCATION, RPL_THEMES, RPL_THEME1, RPL_THEME2, RPL_THEME3, RPL_THEME4)

#Exporting to CSV:
#write.csv(SVI_county,'Data/Processed/SVI_County_Processed.csv', row.names=FALSE)

#Calculate sum of generation by county
Total_Generation_County <-plant_gen_data %>%
  group_by(CNTYNAME)%>%
  summarize(Total_Generation = sum(PLNGENAN))

#Merge SVI and total generation by county data
Generation_SVI <-merge(x = Total_Generation_County,
                           y = SVI_county, 
                           by.x = 'CNTYNAME', 
                           by.y = 'COUNTY' )

#Run regression to determine if there is a relationship
Generation_County_lm <- lm(Total_Generation ~ RPL_THEMES, data=Generation_SVI)

summary_table_SVI <- summary(Generation_County_lm)$coef

knitr::kable(summary(Generation_County_lm)$coef, format = "html", caption = "Linear Regression Results - SVI and Total Generation")

#Residual standard error: 14690000 on 74 degrees of freedom
# Multiple R-squared:  0.005408,	Adjusted R-squared:  -0.008033 
# F-statistic: 0.4023 on 1 and 74 DF,  p-value: 0.5278
# All coefficient p values are > .05
# The regression run on generation by county and RPL_THEMES, the aggregate of Socioeconomic Status (RPL_THEME1), Household Characteristics (RPL_THEME2), Racial & Ethnic Minority Status (RPL_THEME3), and Housing Type & Transportation (RPL_THEME4) as defined by EPA in the Social Vulnerability Index, returned an overall p-value of 0.53. 
```

##### Figure 19: The relationship between the Social Vulnerability Index (SVI) and 2021 annual generation in MWh across all power plants in a county.
```{r Generation and SVI Relationship Analysis Plot}
#Visualize the linear regression
tract_generation_SVI_plot <- ggplot(Generation_SVI, 
                                    aes(x = Total_Generation, 
                                        y = RPL_THEMES)) +
  geom_point()+ylim(0,1)+
  stat_smooth(method = "lm", col = "red")+labs(y='Overall SVI Value', x='Total Generation in 2021 (MWh)',title= 
"Total Power Plant Generation and SVI by county")
print(tract_generation_SVI_plot) 

```


```{r Data Wrangling}

#Filter by North Carolina
Plant_NC <- plant %>% filter(PSTATABB=='NC')
gen_NC <-gen %>% filter(PSTATABB=='NC')

#Create Joined Plot
PowerPlants_DF <-merge(x=gen_NC,y=Plant_NC, by='ORISPL',all.x=TRUE)
```

```{r Creating income groupings, echo=FALSE}

# GENYRRET = Generator planned or actual retirement year (four-digit)
# GENYRONL - year the generator came online (four-digit)

retired_year <- processed_data$GENYRRET %>%
  na.omit()
# earliest year of plant retirement was 2021
# can't run time series analysis with this data, 
# but could run regression analysis to understand relationship between
# planned retirement and 2021 avg household income or
# 2021 retirement and 2021 unemployment

online_plants <- processed_data %>%
  # drop observations with NAs in GENYRONL
  # which means we don't know what year they came online
  # new number of observations should be 1175 (dropping 15 NAs)
  drop_na(GENYRONL) %>%
  select(FIPS_Code, CNTYNAME, SEQGEN, YEAR, PNAME, 
         GENID, GENSTAT, GENYRONL, NAMEPCAP_plant, 
         PLNGENAN, PLCO2AN, COALFLAG, MEDHHINC_2021,	
         Unemployment_rate_2000,	Unemployment_rate_2001,	
         Unemployment_rate_2002,	Unemployment_rate_2003,	
         Unemployment_rate_2004,	Unemployment_rate_2005,	
         Unemployment_rate_2006,	Unemployment_rate_2007,	
         Unemployment_rate_2008,	Unemployment_rate_2009,	
         Unemployment_rate_2010,	Unemployment_rate_2011,	
         Unemployment_rate_2012,	Unemployment_rate_2013,	
         Unemployment_rate_2014,	Unemployment_rate_2015,	
         Unemployment_rate_2016,	Unemployment_rate_2017,	
         Unemployment_rate_2018,	Unemployment_rate_2019,	
         Unemployment_rate_2020,	Unemployment_rate_2021,	
         Unemployment_rate_2022)

online_year <- online_plants$GENYRONL

online_month_day_ <- rep(c("01-01-"), length(online_year))

# repeating month_day_ to fill in month and day
# for as many year entries as are found in 
# dropping NAs but may need to keep them in; decide as group
Date_Online <- paste0(online_month_day_,online_year)
# 1175 observations in Date_Online

# change years to date formats
Date_Online <- as.Date(Date_Online, format = "%m-%d-%Y")

# ensure date column is in date format
online_plants <- online_plants %>%
  mutate(GENYRONL = Date_Online)

# identifying the county with the most power plants
county_freq_table <- table(online_plants$CNTYNAME)
# view(county_freq_table)
#max(county_freq_table) # 48, Robeson County
county_freq_table <- sort(county_freq_table, decreasing = TRUE)
# view(county_freq_table)
robeson_online_plants <- online_plants %>%
  filter(CNTYNAME == "Robeson")
# unique(robeson_online_plants$PNAME) # 44 unique power plant names
# unique(robeson_online_plants$GENID) # 32 unique GENIDs

# multiple regression for just one county, Robeson 
# the one with highest total number of existing plants in 2021
# to understand relationship between year online for each power plant and unemployment 
# need to make table by year
# with 5 columns: Year, FIPS code, number of plants in existence that year, unemployment rate
robeson_year <- year(robeson_online_plants$GENYRONL)
robeson_FIPS_code <- robeson_online_plants$FIPS_Code
## MARKING WHERE GC LEFT OFF
#robeson_plant_count <- tally(robeson_online_plants$PNAME, wt = NULL, sort = FALSE, name = NULL)
#is.Date(robeson_online_plants$GENYRONL)

```

## Summary
This study's initial inquiry sought to uncover how income, a significant socioeconomic indicator, relates to power plant characteristics. The investigation focused on the fuel type, the number, and the total nameplate capacity of power plants, each representing distinct dimensions of interest. Although the study did not produce definitive and statistically significant results regarding the influence of income on the number of power plants or nameplate capacity, it is suggested that this may be due to the complexity of the energy landscape. While one might expect lower generation capacity and fewer power plants in wealthier areas due to potential opposition, it is crucial to consider that energy consumption is often linked to a higher standard of living. Consequently, having generation capacity in higher-income areas may be necessary to meet the increased demand. Although this aspect of the exploration did not yield statistically significant results, it is noteworthy that the type of fuel generation, specifically solar, displayed some significance. The analysis indicated that an increase in median household income is associated with a decrease in solar generation. However, it is important to recognize that, despite being statistically significant, the coefficient of determination (r2) suggests that the explained variance is quite modest, standing at only 0.56%.

# Question 2: Do power plant retirements have a significant impact on unemployment?

Null Hypothesis: The retirement of power plant generators does not have an impact on unemployment rates in the counties in which they are located.

The primary motivation behind this analysis is to delve into the nuanced equilibrium inherent in a just energy transition. The imperative of shifting energy fuel sources from carbon-intensive to fossil fuel-free must be achieved without detriment to communities. In this examination, we initially pinpoint counties in North Carolina with the highest and lowest numbers of retirements, comparing them to their respective unemployment rates over time. To conduct a more pointed analysis, a statistical examination is performed on a specific county of interest.

Power plant retirements were analyzed (using data contained in the 2020 eGRID dataset) to identify which counties had the most number of retired power plants.Counties with no retirements were also selected to provide a comparison. 

##### Figure 20: Number of historical power plant retirements per county based on 2020 eGRID dataset
```{r, Unemployment_Retirements, echo=FALSE, warning=FALSE, error=FALSE}

################ DATA ANALYSIS: UNEMPLOYMENT AND GENERATOR RETIREMENTS ################ 

### Pre-Analysis Wrangling ###

#Set to numeric
gen20$NAMEPCAP <- as.numeric(gen20$NAMEPCAP)
gen20$GENNTOZ <- as.numeric(gen20$GENNTOZ)


#Combining gen20 and plant dataframes based on ORISPL
plant_gen20 <- gen20 %>%
  inner_join(plant_select, by = 'ORISPL', 
             suffix = c("_gen", "_plant"))

#Removing duplicate state abbreviation column
plant_gen_data_20 <- plant_gen20[, -which(names(plant_gen) == "PSTATABB_plant")]

#Merging with eGrid
ue_egrid_20 <- merge(plant_gen_data_20, ue, by = "FIPS_Code")

#Merging with income
processed_data_20 <- merge(ue_egrid_20, inc, by = "FIPS_Code")


#Transposing and wrangling both in order to view:
#   1. NC county unemployment by year, where we have a column for all years rather than each year having its own column
#   2. Generator retirement by year, selecting only those with instances of retired generators

#Unemployment
transposed_ue <- ue %>%
  filter(str_starts(FIPS_Code, "37")) %>%  # Filter to include only NC
  pivot_longer(cols = starts_with("Unemployment_rate_"), 
               names_to = "Year", 
               values_to = "Unemployment") %>%
  mutate(Year = gsub("Unemployment_rate_", "", Year, fixed = TRUE)) %>%
  pivot_wider(names_from = "FIPS_Code", values_from = "Unemployment")

#Generator
generator_retirement_data <- processed_data_20 %>% 
  select(FIPS_Code, GENYRRET) %>%
  na.omit()  #showing only generators that have retired


###### EXPLORATION #######

#Use table to count the occurrences of each unique FIPS code to select counties of interest
fips_counts <- table(generator_retirement_data$FIPS_Code)

for (i in seq_along(fips_counts)) {
  fips <- names(fips_counts)[i]
  count <- fips_counts[i]
  cat("FIPS Code:", fips, "has", count, "rows.\n")}

fips_counts <- table(generator_retirement_data$FIPS_Code)#identifies 2 counties with 7 instances of retirements

```

Based on the dataset above, FIPS Code 37159 (Rowan) and 37191 (Wayne) each have the highest number of retirements at 7 rows. FIPS Code 37023  (Burke) 37041 (Chowan) 37049  (Craven) 37063 (Durham) 37067 (Forsyth) 37069 (Franklin) 37125 (Moore) each have 1 row.

In this analysis, counties experiencing both high (blue) and low (green) numbers of generator retirements, such as Rowan and Wayne (high retirements) and Burke and Craven (low retirements), are singled out. The objective is to investigate whether fluctuations in unemployment rates are influenced by generator retirements or if the rates exhibit similar trends irrespective of such retirements. Through this exploratory analysis, the goal is to discern any distinctive patterns in unemployment dynamics. As the plot in Figure 21 below shows instances in which the unemployment rates do not follow the hypothesized pattern, another variable was chosen for statistical analysis.

##### Figure 21: Historical unemployment rates in Wayne, Rowan, Durham, and Chowan Counties
```{r, cols_interest, echo=FALSE, warning=FALSE, error=FALSE}

#Creating df for only columns.counties of interest
rowan_ue <- transposed_ue[, c("Year", "37159")]
wayne_ue <- transposed_ue[, c("Year", "37191")]
durham_ue <- transposed_ue[, c("Year", "37063")] 
Chowan_ue <- transposed_ue[, c("Year", "37049")] 

rowan_ret <-  generator_retirement_data[generator_retirement_data$FIPS_Code == 37159, ]
wayne_ret <-  generator_retirement_data[generator_retirement_data$FIPS_Code == 37191, ]
durham_ret <-  generator_retirement_data[generator_retirement_data$FIPS_Code == 37063, ]
Chowan_ret <-  generator_retirement_data[generator_retirement_data$FIPS_Code == 37049, ]


#Converting to date format
rowan_ue$Year <- as.Date(rowan_ue$Year, format = "%Y")
wayne_ue$Year <- as.Date(wayne_ue$Year, format = "%Y")
durham_ue$Year <- as.Date(durham_ue$Year, format = "%Y")
Chowan_ue$Year <- as.Date(durham_ue$Year, format = "%Y")

#Plot
combined_plot <- ggplot() +
  geom_line(data = rowan_ue, aes(x = Year, y = `37159`, color = "Rowan"), size = 1) +
  geom_line(data = wayne_ue, aes(x = Year, y = `37191`, color = "Wayne"), size = 1) +
  geom_line(data = durham_ue, aes(x = Year, y = `37063`, color = "Durham"), size = 1) +
  geom_line(data = Chowan_ue, aes(x = Year, y = `37049`, color = "Chowan"), size = 1) +
  geom_vline(xintercept = 2012, linetype = "dashed", color = "black", size = 1) +
  labs(title = "Unemployment in Wayne, Rowan, Durham, and Chowan Counties",
       x = "Year",
       y = "Unemployment Rate (%)",
       color = "Dataset") +
  scale_color_manual(values = c("Rowan" = "blue", "Wayne" = "lightblue", "Durham" = "darkgreen", "Chowan" = "lightgreen")) +
  theme(legend.title = element_blank())

print(combined_plot)
```

Contrary to the initial hypothesis, this regression indicates that for each MW increase in retired nameplate capacity, the unemployment rate unemployment rate in Rowan is expected to decrease by approximately 0.02428 percentage points. The p-value is greater than 0.05, but given that it is only marginally higher (at 0.0619) we can theoretically interpret there to be a weak relationship. It must also be understood that the sample size is small and therefore we would need much more data for any reliable conclusions.

The Multiple R-squared value of 0.5346 represents the proportion of the variance in the response variable (Rowan UE (%)) that can be explained by the predictor variable retired nameplate capacity (MW).

```{r Rowan analysis, echo=FALSE, warning=FALSE, error=FALSE}
#Selecting Rowan only
rowan_data <- generator_retirement_data[generator_retirement_data$FIPS_Code == 37159, ]

#Rename generator retirement year to year in order to combine for analysis
colnames(rowan_data)[colnames(rowan_data) == "GENYRRET"] <- "Year"

#Reformat year in rowan_ue as numeric for merging
rowan_ue$Year <- as.numeric(format(rowan_ue$Year, "%Y"))

#Merge by year
rowan_merged_data <- merge(rowan_data, rowan_ue, by = "Year", all.x = TRUE)


### Data Wrangling ###

#Renaming columnn
names(rowan_ue)[trimws(names(rowan_ue)) == "37159"] <- "Rowan UE (%)"

#Adding nameplate capacity to generator
rowan_generator_retirement_NPACP <- processed_data_20 %>% 
  select(FIPS_Code, GENYRRET, NAMEPCAP_gen) %>%
  filter(FIPS_Code == "37159") %>%  # Filter for Rowan county
  na.omit() %>% #selecting only data with retirements
  rename(Year = GENYRRET)  # Renaming the column

#Merging
rowan_merged_data_NPCAP <- merge(rowan_generator_retirement_NPACP, rowan_ue, by = "Year", all.x = TRUE)

#### Data Analysis ###

#Linear regression
lm_result <- lm(`Rowan UE (%)` ~ NAMEPCAP_gen, data = rowan_merged_data_NPCAP)
# summary(lm_result) 
```


## Summary
The examination of the impact resulting from the retirement of power plant generators failed to produce definitive results; nevertheless, it contributes to the expanding field of advocating for an environmental justice perspective. This research goes beyond the reliance on the reduction of tons of carbon dioxide equivalents in emissions as a measure of the energy transition's success. It underscores the importance of adopting a holistic approach to key performance indicators, particularly given that large power plants are often situated in rural areas where communities heavily depend on utilities for employment. The analytical methodology adheres to best practices, incorporating counties with varying numbers of retirements to control for factors external to the retirements themselves. Additionally, the analysis delves into the actual nameplate capacity of retired assets, recognizing the plausible implication that a smaller capacity may employ fewer individuals compared to a larger plant. Contrary to the initial hypothesis, the findings reveal a statistically significant relationship, wherein each megawatt increase in retired nameplate capacity is associated with a marginal decrease in the unemployment rate. However, the inherent data limitations within this relatively small sample size necessitate cautious interpretation. It is crucial to acknowledge that while this analysis falls short of providing conclusive results, it serves as a foundation for further exploration in subsequent analyses and environmental justice research.

# Question 3: Does publicly available data show a relationship between power generation and social vulnerability, health vulnerability, or environmental burden?

Null hypothesis: There is no relationship between power plant distribution and social vulnerability, health vulnerability, or environmental burden.

********May insert an SVI piece from Q1 here*******

Among the emissions types tracked as part of the eGRID dataset used in Questions 1 and 2, nitrogen oxides (NOx) and sulfur dioxide merit further exploration, as they form part of criteria air pollutants regulated by EPA. Under the Clean Air Act, US EPA has set National Ambient Air Quality Standards on six criteria air pollutants: particulate matter (PM2.5 and PM10), atmospheric ozone, carbon monoxide, lead, nitrogen dioxide, and sulfur dioxide. These pollutants reach widespread exposure--millions of people--due to their numerous and diverse sources. Causal or likely causal evidence pointing to a variety of negative health endpoints exists for each one of them. 

Power plants have historically made up a major stationary point source of air pollution, including SO2 and NO2, in particular. For nitrogen dioxide (NO2) and sulfur dioxide (SO2), the regulatory emissions standard-setting has been most heavily informed by research on respiratory effects. It should be noted that nitrogen oxides (NOx) also contribute to the formation of atmospheric ozone, which causes respiratory problems. 

```{r Q3 Data Wrangling}

#### Attach spatial data to EJI based on census tracts ####

#Establish shared GEOID format
EJI_countytract$CountyFIPS <- stringr::str_extract(EJI_countytract$GEOID, "^.{5}")

#Get 2021 spatial census data to convert tract GEOID to mapped coordinates
spatial_tracts <- tigris::tracts(state = 37) %>% 
  st_as_sf()
# class(spatial_tracts)
# st_crs(spatial_tracts) # NAD1983, EPSG 4269

#Join the eGrid attributes to the county spatial features
tracts_EJI_sf_join <-  merge(x = spatial_tracts,
                           y = EJI_countytract, 
                           by.x = 'GEOID', 
                           by.y = 'GEOID' )
#Some EJI tracts did not have GEOIDs that matched the spatial tracts

#Select variables of interest
tracts_EJI_sf_select <- tracts_EJI_sf_join %>%
  select(GEOID, CountyFIPS, TRACTCE.x, StateAbbr, COUNTY, E_TOTPOP, M_TOTPOP, 
         RPL_EBM, RPL_HVM, RPL_SVM, E_PM, E_OZONE, E_DSLPM, E_COAL, EP_UNINSUR, 
         EP_AGE65, EP_ASTHMA, EP_BPHIGH, EP_CANCER, EP_MHLTH, geometry) %>%
  rename(TractCode = TRACTCE.x)

#### Power plant data by tract ####

#Check coordinates of plant geometry (point) data
# st_crs(plant_gen_sf$geometry) # NAD1983, EPSG 4269

#Match coordinates of plants_NC to tract geometry
#plants_within_tracts <- plant_gen_sf[tracts_EJI_sf_select,]
tracts_containing_plants <- tracts_EJI_sf_select[plant_gen_sf,]

#Convert NC eGrid tabular county data to spatial data
plants_NC_sf <- Plant_NC %>% 
  st_as_sf(coords = c('LON','LAT'), crs=4269)

#Table of plant data with the tract that corresponds to each plant
intersection_plants_EJI <- st_intersection(plants_NC_sf, tracts_EJI_sf_select)

#Exporting to CSV:
#write.csv(intersection_plants_EJI,'Data/Processed/EBM_Processed.csv', row.names=FALSE)

```

```{r County SVI and Total Power Generation}
# Move RPL_THEMES chunk here
```
At the county level across North Carolina in 2021, percentile rank for the Social Vulnerability Index across themes ________ as total power generation _______.


```{r Tract Environmental Burden and Total Power Generation}

EB_totalgen_lm <- lm(data = intersection_plants_EJI, RPL_EBM ~ NAMEPCAP)
# summary(EB_totalgen_lm)
# Residual standard error: 0.2394 on 536 degrees of freedom. Multiple R-squared:  5.337e-06,	Adjusted R-squared:  -0.00186. F-statistic: 0.002861 on 1 and 536 DF,  p-value: 0.9574

ozone_namep_lm <- lm(data = intersection_plants_EJI, E_OZONE ~ NAMEPCAP)
# summary(ozone_namep_lm)
# Residual standard error: 0.3245 on 538 degrees of freedom
# Multiple R-squared:  0.005192,	Adjusted R-squared:  0.003342 
# F-statistic: 2.808 on 1 and 538 DF,  p-value: 0.0944

DSLPM_namep_lm <- lm(data = intersection_plants_EJI, E_DSLPM ~ NAMEPCAP)
# summary(DSLPM_namep_lm)
# Residual standard error: 0.08264 on 537 degrees of freedom
#   (1 observation deleted due to missingness)
# Multiple R-squared:  0.0002972,	Adjusted R-squared:  -0.001564 
# F-statistic: 0.1597 on 1 and 537 DF,  p-value: 0.6896

PM_namep_lm <- lm(data = intersection_plants_EJI, E_PM ~ NAMEPCAP)
# summary(PM_namep_lm)
# Residual standard error: 0.7128 on 538 degrees of freedom
# Multiple R-squared:  0.0002181,	Adjusted R-squared:  -0.00164 
# F-statistic: 0.1173 on 1 and 538 DF,  p-value: 0.7321

```
At the tract level across North Carolina in 2021, percentile rank for Environmental Burden ________ as total power generation _______.

Running a single linear regression on nameplate capacity from eGRID and overall Environmental Burden module percentile rank from EJI and eGrid did not show that there is a significant relationship between the two variables per tract in North Carolina. Selecting key environmental burden variables of interest--annual mean days above PM2.5 regulatory standard (E_PM), annual mean days above O3 regulatory standard (E_OZONE), and ambient concentrations of diesel PM/m3 (E_DSLPM)--for a multiple regression on nameplate capacity returns E_OZONE and E_DSLPM as variables to include, and E_PM as a variable to drop from the regression. The resulting, new multiple regression of nameplate capacity against E_OZONE and E_DSLPM still has a p-value of .08, however, so the null hypothesis that there is no relationship between the environmental burden variables examined in this analysis and nameplate capacity per tract cannot be rejected. An existing relationship cannot be concluded.

```{r Tract Health Vulnerability and Total Power Generation}

HV_totalgen_lm <- lm(data = intersection_plants_EJI, RPL_HVM ~ NAMEPCAP)
# summary(HV_totalgen_lm)
# Residual standard error: 0.3108 on 536 degrees of freedom. Multiple R-squared:  0.0006052,	Adjusted R-squared:  -0.001259. F-statistic: 0.3246 on 1 and 536 DF,  p-value: 0.5691

multivarHV_totalgen_lm <- lm(data = intersection_plants_EJI, 
                             NAMEPCAP ~ EP_ASTHMA + EP_BPHIGH + 
                                        EP_CANCER + EP_MHLTH)
# step(multivarHV_totalgen_lm)
# Start:  AIC=5931.83
# NAMEPCAP ~ EP_ASTHMA + EP_BPHIGH + EP_CANCER + EP_MHLTH
# 
#             Df Sum of Sq      RSS    AIC
# - EP_ASTHMA  1      7887 32450152 5930.0
# - EP_MHLTH   1     33192 32475457 5930.4
# - EP_BPHIGH  1     38490 32480755 5930.5
# <none>                   32442265 5931.8
# - EP_CANCER  1    211498 32653763 5933.3
# 
# Step:  AIC=5929.96
# NAMEPCAP ~ EP_BPHIGH + EP_CANCER + EP_MHLTH
# 
#             Df Sum of Sq      RSS    AIC
# - EP_MHLTH   1     40092 32490244 5928.6
# <none>                   32450152 5930.0
# - EP_BPHIGH  1    175823 32625975 5930.9
# - EP_CANCER  1    253198 32703350 5932.1
# 
# Step:  AIC=5928.62
# NAMEPCAP ~ EP_BPHIGH + EP_CANCER
# 
#             Df Sum of Sq      RSS    AIC
# <none>                   32490244 5928.6
# - EP_BPHIGH  1    148442 32638686 5929.1
# - EP_CANCER  1    274873 32765117 5931.2
# 
# Call:
# lm(formula = NAMEPCAP ~ EP_BPHIGH + EP_CANCER, data = intersection_plants_EJI)
# 
# Coefficients:
# (Intercept)    EP_BPHIGH    EP_CANCER  
#       3.876       -3.268       24.099  

cancer_namep_lm <- lm(data = intersection_plants_EJI, EP_CANCER ~ NAMEPCAP)
# summary(cancer_namep_lm)
# Residual standard error: 1.005 on 536 degrees of freedom
#   (2 observations deleted due to missingness)
# Multiple R-squared:  0.005194,	Adjusted R-squared:  0.003338 
# F-statistic: 2.799 on 1 and 536 DF,  p-value: 0.09493

BP_namep_lm <- lm(data = intersection_plants_EJI, EP_BPHIGH ~ NAMEPCAP)
# summary(BP_namep_lm)
# Residual standard error: 5.459 on 536 degrees of freedom
#   (2 observations deleted due to missingness)
# Multiple R-squared:  0.001341,	Adjusted R-squared:  -0.0005225 
# F-statistic: 0.7196 on 1 and 536 DF,  p-value: 0.3967

test <- lm(data = intersection_plants_EJI, UNNOX ~ UNSO2)
#summary(test)

```
At the tract level across North Carolina in 2021, percentile rank for Health Vulnerability ________ as total power generation _______.

```{r Tract EB and HV and Total Power Generation}

multivar_EBHV_totalgen_lm <- lm(data = intersection_plants_EJI, 
                             NAMEPCAP ~ E_PM + E_OZONE + E_DSLPM +
                             EP_ASTHMA + EP_BPHIGH + EP_CANCER + EP_MHLTH)
# step(multivar_EBHV_totalgen_lm)
# Start:  AIC=5934.51
# NAMEPCAP ~ E_PM + E_OZONE + E_DSLPM + EP_ASTHMA + EP_BPHIGH + 
#     EP_CANCER + EP_MHLTH
# 
#             Df Sum of Sq      RSS    AIC
# - EP_ASTHMA  1       846 32243423 5932.5
# - EP_MHLTH   1     13811 32256387 5932.7
# - EP_BPHIGH  1     27395 32269971 5933.0
# - E_PM       1     41508 32284084 5933.2
# - E_DSLPM    1    102708 32345284 5934.2
# <none>                   32242576 5934.5
# - E_OZONE    1    143198 32385775 5934.9
# - EP_CANCER  1    172718 32415295 5935.4
# 
# Step:  AIC=5932.52
# NAMEPCAP ~ E_PM + E_OZONE + E_DSLPM + EP_BPHIGH + EP_CANCER + 
#     EP_MHLTH
# 
#             Df Sum of Sq      RSS    AIC
# - EP_MHLTH   1     30795 32274217 5931.0
# - E_PM       1     42455 32285878 5931.2
# - EP_BPHIGH  1     83068 32326490 5931.9
# - E_DSLPM    1    107997 32351420 5932.3
# <none>                   32243423 5932.5
# - E_OZONE    1    146672 32390095 5933.0
# - EP_CANCER  1    190359 32433782 5933.7
# 
# Step:  AIC=5931.03
# NAMEPCAP ~ E_PM + E_OZONE + E_DSLPM + EP_BPHIGH + EP_CANCER
# 
#             Df Sum of Sq      RSS    AIC
# - E_PM       1     46177 32320394 5929.8
# - EP_BPHIGH  1     52510 32326728 5929.9
# - E_DSLPM    1    117178 32391396 5931.0
# <none>                   32274217 5931.0
# - E_OZONE    1    149927 32424144 5931.5
# - EP_CANCER  1    199982 32474200 5932.4
# 
# Step:  AIC=5929.8
# NAMEPCAP ~ E_OZONE + E_DSLPM + EP_BPHIGH + EP_CANCER
# 
#             Df Sum of Sq      RSS    AIC
# - EP_BPHIGH  1     63474 32383868 5928.9
# - E_DSLPM    1     72705 32393099 5929.0
# <none>                   32320394 5929.8
# - E_OZONE    1    163998 32484392 5930.5
# - EP_CANCER  1    175634 32496028 5930.7
# 
# Step:  AIC=5928.86
# NAMEPCAP ~ E_OZONE + E_DSLPM + EP_CANCER
# 
#             Df Sum of Sq      RSS    AIC
# - E_DSLPM    1     69162 32453030 5928.0
# <none>                   32383868 5928.9
# - EP_CANCER  1    124663 32508531 5928.9
# - E_OZONE    1    254739 32638607 5931.1
# 
# Step:  AIC=5928.01
# NAMEPCAP ~ E_OZONE + EP_CANCER
# 
#             Df Sum of Sq      RSS    AIC
# <none>                   32453030 5928.0
# - E_OZONE    1    185656 32638686 5929.1
# - EP_CANCER  1    189601 32642631 5929.1
# 
# Call:
# lm(formula = NAMEPCAP ~ E_OZONE + EP_CANCER, data = intersection_plants_EJI)
# 
# Coefficients:
# (Intercept)      E_OZONE    EP_CANCER  
#      -96.67        57.21        18.68 
```

Is there a relationship between eGRID power plant data on emissions of known criteria air pollutants and health vulnerability data from EJI by tract across North Carolina?

```{r Relationship between HV and emissions}

HV_emissions_multivar <- lm(data = intersection_plants_EJI,
                            RPL_HVM ~ PLNOXAN + PLSO2AN + PLCO2AN + PLCH4AN)
step(HV_emissions_multivar)

opt_HV_emissions_multivar <- lm(RPL_HVM ~ PLSO2AN + PLCH4AN, data = intersection_plants_EJI)
summary(opt_HV_emissions_multivar)
```

The following section of analyses explore relationships between emissions of SO2 and NOx and respiratory effects using eGRID data as well as data from the Environmental Burden and Health Vulnerability modules in the Environmental Justice Index (EJI). The development of the EJI is relatively new and the index has limitations. In accordance with its limitations, which can be found in detail within the technical documentation linked in the Metadata folder, this high-level exploration is not intended to define individuals at risk, represent risk or exposure for a community, or suggest that the markers explored form a full or near-full representation of environmental or health characteristics. This brief exploration merely examines whether a statistically significant relationship can be detected among select local factors such as power plant emissions and human health effects at a point in time across North Carolina. Based on established knowledge regarding air pollution and its impacts to human health, the expectation would be that higher emissions of NOx and SO2 are associated with higher rates of respiratory disease. 

```{r Relationship between Asthma and NOx and SO2}

Asthma_emissions_multivar <- lm(data = intersection_plants_EJI,
                            EP_ASTHMA ~ PLNOXAN + PLSO2AN + PLCO2AN + PLCH4AN)
step(Asthma_emissions_multivar)
# Start:  AIC=16.84
# EP_ASTHMA ~ PLNOXAN + PLSO2AN + PLCO2AN + PLCH4AN
# 
#           Df Sum of Sq    RSS    AIC
# - PLNOXAN  1   0.52828 79.699 15.315
# - PLSO2AN  1   0.63075 79.802 15.407
# - PLCH4AN  1   1.24704 80.418 15.961
# - PLCO2AN  1   1.56534 80.736 16.245
# <none>                 79.171 16.836
# 
# Step:  AIC=15.31
# EP_ASTHMA ~ PLSO2AN + PLCO2AN + PLCH4AN
# 
#           Df Sum of Sq    RSS    AIC
# - PLSO2AN  1    0.3739 80.073 13.652
# - PLCO2AN  1    1.0956 80.795 14.298
# - PLCH4AN  1    1.5535 81.253 14.705
# <none>                 79.699 15.315
# 
# Step:  AIC=13.65
# EP_ASTHMA ~ PLCO2AN + PLCH4AN
# 
#           Df Sum of Sq    RSS    AIC
# - PLCO2AN  1   0.83999 80.913 12.403
# <none>                 80.073 13.652
# - PLCH4AN  1   2.42157 82.495 13.797
# 
# Step:  AIC=12.4
# EP_ASTHMA ~ PLCH4AN
# 
#           Df Sum of Sq    RSS    AIC
# <none>                 80.913 12.403
# - PLCH4AN  1    2.3735 83.287 12.485
# 
# Call:
# lm(formula = EP_ASTHMA ~ PLCH4AN, data = intersection_plants_EJI)
# 
# Coefficients:
# (Intercept)      PLCH4AN  
#   1.056e+01   -7.383e-07 

summary(Asthma_emissions_multivar)
# Residuals:
#     Min      1Q  Median      3Q     Max 
# -1.8219 -0.7684 -0.1119  0.3883  3.0864 
# 
# Coefficients:
#               Estimate Std. Error t value Pr(>|t|)    
# (Intercept)  1.051e+01  1.376e-01  76.379   <2e-16 ***
# PLNOXAN     -2.522e-04  3.772e-04  -0.669    0.506    
# PLSO2AN      7.181e-04  9.829e-04   0.731    0.468    
# PLCO2AN      2.776e-07  2.412e-07   1.151    0.254    
# PLCH4AN     -2.446e-06  2.381e-06  -1.027    0.308    
# ---
# Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
# 
# Residual standard error: 1.087 on 67 degrees of freedom
#   (468 observations deleted due to missingness)
# Multiple R-squared:  0.04942,	Adjusted R-squared:  -0.007336 
# F-statistic: 0.8707 on 4 and 67 DF,  p-value: 0.4862

Asthma_NOxSO2_multivar <- lm(data = intersection_plants_EJI,
                            EP_ASTHMA ~ PLNOXAN + PLSO2AN)
#step(Asthma_NOxSO2_multivar)
```

Knowing that NOx contribute to atmospheric ozone formation in addition to having direct human health effects, we were curious whether a multiple regression of annual mean days above O3 regulatory standard (E_OZONE) against emissions of NOx, SO2, CO2, and CH4 might elevate NOx emissions from power plants as the variable that might most explain E_OZONE. While it performed as the strongest amongst the multiple regression variables, it ultimately did not return a significant relationship when run as a single linear regression against E_OZONE (the p-value of the single linear regression was 0.985). While a relationship between the two variables could not be concluded and a lack of relationship could not be rejected, it is worth noting that E_OZONE is is annual mean days above O3 regulatory standard calculated using a 3-year average--it is not the atmospheric concentration level measured at each tract.

```{r Relationship between atmospheric ozone levels and emissions}

Ozone_emissions_multivar <- lm(data = intersection_plants_EJI,
                            E_OZONE ~ PLNOXAN + PLSO2AN + PLCO2AN + PLCH4AN)
step(Ozone_emissions_multivar)

opt_Ozone_emissions_multivar <- lm(E_OZONE ~ PLNOXAN + PLSO2AN + PLCO2AN, data = intersection_plants_EJI)
summary(opt_Ozone_emissions_multivar)
```

##### Figure 22: The relationship between adjusted NOx emissions and SO2 emissions from North Carolina power plants in 2021. As noted in the eGRID metadata file, certain plants' emissions may be adjusted if the plant is a CHP (combined heat and power) facility or if one or more of its units burns biomass. 

```{r Plotting relationship between adjusted NOx emissions and SO2 emissions}

## Might plants those plants that emit high levels of NOx overlap with those that emit high levels of SO2? ## 
NOx_SO2_plot <- ggplot(intersection_plants_EJI, 
                          aes(x=PLNOXAN, y=PLSO2AN)) +
  geom_point() +
  # adjusting axes to hide extreme values
  xlim(0, 550) +
  ylim(0,700) +
  # finding a line of best fit
  geom_smooth(method = lm, color = "black") +
  ggtitle("Relationship between Adjusted NOx and SO2 Emissions") + 
  labs(x="Plant Annual NOx Emissions \n (short tons)", y="Plant Annual SO2 Emissions \n (short tons)")
print(NOx_SO2_plot)
```

##### Figure 23: The relationship between unadjusted NOx emissions and SO2 emissions from North Carolina power plants in 2021. 

```{r Plotting relationship between unadjusted NOx SO2 emissions}

## Might plants those plants that emit high levels of NOx overlap with those that emit high levels of SO2? ## 
UNNOx_UNSO2_plot <- ggplot(intersection_plants_EJI, 
                          aes(x=UNNOX, y=UNSO2)) +
  geom_point() +
  # adjusting axes to hide extreme values
  xlim(0, 4000) +
  ylim(0, 5000) +
  # finding a line of best fit
  geom_smooth(method = lm, color = "black") +
  ggtitle("Relationship between Unadjusted NOx and SO2 Emissions") + 
  labs(x="Plant Annual NOx Emissions \n (short tons)", y="Plant Annual SO2 Emissions \n (short tons)")
print(UNNOx_UNSO2_plot)
```

Given that NOx (including NO2) and SO2 both have negative human health impacts and especially respiratory impacts, we were curious to explore whether those plants that emit high levels of NOx might overlap with those that emit high levels of SO2. Plotting the relationship as in Figures 22 and 23 above appears to show a relationship between emitted NOx and SO2 from power plants in 2021, however, the relationship merits further exploration through linear regression and correlation testing. If power plants that are emitting high levels of NOx are also emitting high levels of SO2, this could be impactful information for air quality management professionals looking to make decisions on how to reduce emissions from power plant sources and which plants to prioritize. 

``` {r Regression on NOx Emissions and SO2 Emissions}
SO2_NOx_lm <- lm(data = intersection_plants_EJI, PLSO2AN ~ PLNOXAN)
# summary(SO2_NOx_lm)
# Residuals range from -491.27 to 1260.12
# Intercept is 0.46503 so there is a positive relationship which means when NOx increase, SO2 tend to increase as well. p-value: < 2.2e-16 which is <.05, therefore it is worthwhile to try to estimate SO2 based on depth information. Although the residual standard error is 238.7 on 199 degrees of freedom, the R-squared value of 0.8274 shows that NOx emissions explain around 82.74% of the variability of SO2 emissions. 
# plot(SO2_NOx_lm)
# Pearson's
cor.test(intersection_plants_EJI$PLSO2AN, intersection_plants_EJI$PLNOXAN)
# Kendall tau
cor.test(intersection_plants_EJI$PLSO2AN, intersection_plants_EJI$PLNOXAN, method="kendall")
# Spearman
cor.test(intersection_plants_EJI$PLSO2AN, intersection_plants_EJI$PLNOXAN, method="spearman")
# The correlation test returns a correlation strength of 0.9096, which signifies a strong correlation between NOx emissions and SO2 emissions. In summary, there is a strong positive correlation.

####### TO BE EDITED 12/12 #######
# <- lm(data = intersection_plants_EJI, UNNOX ~ UNSO2)
#summary()

cor.test(intersection_plants_EJI$UNSO2, intersection_plants_EJI$UNNOX)
```

******* Write up the results from cor.test and lm *******

## Summary
This study used data from CDC's Environmental Burden piece of its Environmental Justice Index to test the hypothesis that greater presence of power plants in a county is correlated with elevated NOx and SOx levels in that county, and consequently more respiratory and cardiovascular problems in comparison to those counties with fewer power plants.
- Results 
- Expect that in the 2020s, NO2 and SO2 emissions would be showing effects of decades of regulation / technologies used to decrease NO2 emissions (changing temperature of combustion in power plants to reduce their formation) and SO2 (touch on atmospheric deposition)

While the Clean Air Act and its various amendments have been in effect for decades, its effectiveness in reducing air pollution in the U.S. by way of regulating emissions of criteria air pollutants has varied over time and varied by pollutant. Air pollution continues to affect millions in the United States. 
- Future tracking of PM in eGRID
- PM currently regulated based on particle size
- Hypothesis that PM associated with coal-fired power plants has higher toxicity than general particulate matter https://www.science.org/doi/10.1126/science.adf4915 


# References
*Supporting the nation’s coal workers and communities in a changing energy landscape. Union of Concerned Scientists. (2021).https://www.ucsusa.org/resources/support-coal-workers#read-online-content.   

*United States Environmental Protection Agency (EPA). 2023. “Emissions & Generation Resource Integrated Database (eGRID), 2021” Washington, DC: Office of Atmospheric Protection, Clean Air Markets Division. Available from EPA’s eGRID web site: https://www.epa.gov/egrid. Accessed on 11/1/2023.

*United States Census Bureau. Cartographic Boundary Files - Shapefile. 2018 County. https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html. Accessed on 11/15/2023.

*United States Department of Agriculture / Economic Research Service. Poverty estimates for the U.S., States, and counties, 2021. https://www.ers.usda.gov/data-products/county-level-data-sets/county-level-data-sets-download-data/. Accessed on 11/1/2023.

*United States Department of Agriculture / Economic Research Service. Unemployment and median household income for the U.S., States, and counties, 2000–22. https://www.ers.usda.gov/data-products/county-level-data-sets/county-level-data-sets-download-data/. Accessed on 11/1/2023.

*Centers for Disease Control and Prevention and Agency for Toxic Substances Disease Registry/ Geospatial Research, Analysis, and Services Program. CDC/ATSDR Social Vulnerability Index 2020. Database North Carolina. https://www.atsdr.cdc.gov/placeandhealth/svi/data_documentation_download.html. Accessed on 12/6/2023.

*Centers for Disease Control and Prevention and Agency for Toxic Substances Disease Registry. 2022 Environmental Justice Index. https://www.atsdr.cdc.gov/placeandhealth/eji/index.html. Accessed on 12/5/2023.
